{% from 'virtual-offline-pike-ovs-dpdk/underlay.yaml' import HOSTNAME_CFG01 with context %}

{% import 'shared-core.yaml' as SHARED_CORE with context %}

- description: remove apparmor
  cmd: salt --hard-crash --state-output=mixed --state-verbose=False
    '*' cmd.run 'service apparmor stop; service apparmor teardown; update-rc.d -f apparmor remove; apt-get -y remove apparmor'
  node_name: {{ HOSTNAME_CFG01 }}
  retry: {count: 1, delay: 10}
  skip_fail: true

{{ SHARED_CORE.MACRO_INSTALL_KEEPALIVED() }}
{{ SHARED_CORE.MACRO_INSTALL_GLUSTERFS() }}
{{ SHARED_CORE.MACRO_INSTALL_RABBITMQ() }}
{{ SHARED_CORE.MACRO_INSTALL_GALERA() }}
{{ SHARED_CORE.MACRO_INSTALL_HAPROXY() }}
{{ SHARED_CORE.MACRO_INSTALL_NGINX() }}
{{ SHARED_CORE.MACRO_INSTALL_MEMCACHED() }}
{{ SHARED_CORE.MACRO_CHECK_VIP() }}
