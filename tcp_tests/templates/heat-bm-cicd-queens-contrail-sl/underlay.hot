---

heat_template_version: queens

description: MCP environment for heat-bm-cicd-queens-contrail-sl

parameters:
  instance_domain:
    type: string
    default: heat-bm-cicd-queens-contrail-sl.local
  management_vlan:
    type: string
    default: 2421
  control_vlan:
    type: string
    default: 2422
  mcp_version:
    type: string
  env_name:
    type: string
  key_pair:
    type: string
  cfg_flavor:
    type: string
  vsrx_flavor:
    type: string
  cfg_availability_zone:
    type: string

resources:
  networks:
    type: MCP::Subnets
    properties:
      stack_name: { get_param: "OS::stack_name" }
      env_name: { get_param: env_name }

  #flavors:
  #  type: MCP::Flavors

  cfg01_node:
    type: MCP::MasterNode
    depends_on: [networks]
    properties:
      env_name: { get_param: env_name }
      mcp_version: { get_param: mcp_version }
      cfg01_flavor: { get_param: cfg_flavor }
      tenant_net_static_ip:
        list_join:
        - '.'
        - [ { get_attr: [networks, tenant_net_prefix] }, '15' ]
      external_net_static_ip:
        list_join:
        - '.'
        - [ { get_attr: [networks, external_net_prefix] }, '15' ]
      instance_name: cfg01
      instance_domain: {get_param: instance_domain}
      network: { get_attr: [networks, network] }

  foundation_node:
    type: MCP::FoundationNode
    depends_on: [networks]
    properties:
      env_name: { get_param: env_name }
      mcp_version: { get_param: mcp_version }
      instance_domain: {get_param: instance_domain}
      instance_name: foundation
      instance_flavor: {get_param: foundation_flavor}
      network: { get_attr: [networks, network] }
      underlay_userdata: { get_file: ./underlay--user-data-foundation.yaml }
      control_net_static_ip:
        list_join:
        - '.'
        - [ { get_attr: [networks, control_net_prefix] }, '5' ]
      tenant_net_static_ip:
        list_join:
        - '.'
        - [ { get_attr: [networks, tenant_net_prefix] }, '5' ]
      external_net_static_ip:
        list_join:
        - '.'
        - [ { get_attr: [networks, external_net_prefix] }, '5' ]
      instance_config_host: { get_attr: [cfg01_node, instance_address] }
...
